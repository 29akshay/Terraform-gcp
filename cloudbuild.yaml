steps:
  # Initialize Terraform with the GCS backend bucket from the substitution
  - id: "terraform-init"
    name: "hashicorp/terraform:1.5.7"
    entrypoint: "sh"
    args:
      - -c
      - |
        set -e
        terraform init -backup= -backend-config="bucket=${bakend}"
    dir: "terraform"

  # Create a plan and print it (so it's visible in build logs)
  - id: "terraform-plan"
    name: "hashicorp/terraform:1.5.7"
    entrypoint: "sh"
    args:
      - -c
      - |
        set -e
        terraform plan -out=tfplan
        terraform show -no-color tfplan
    dir: "terraform"

  # OPTIONAL: apply step (recommended behind manual approval for prod)
  # - id: "terraform-apply"
  #   name: "hashicorp/terraform:1.5.7"
  #   entrypoint: "sh"
  #   args:
  #     - -c
  #     - |
  #       set -e
  #       terraform apply -auto-approve tfplan
  #   dir: "terraform"

substitutions:
  # Replace with your actual GCS bucket name used for Terraform remote state
  _TF_STATE_BUCKET: "bakend"

# Allow longer runs for provisioning, adjust if needed
timeout: "1200s"

options:
  logging: CLOUD_LOGGING_ONLY
